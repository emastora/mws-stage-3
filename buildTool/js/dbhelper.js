"use strict";var _createClass=function(){function r(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(t,e,n){return e&&r(t.prototype,e),n&&r(t,n),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var DBHelper=function(){function n(){_classCallCheck(this,n)}return _createClass(n,null,[{key:"checkStatus",value:function(t){return 200===t.status?Promise.resolve(t):Promise.reject(new Error("Request has failed. Return status: "+t.statusText))}},{key:"json",value:function(t){return t.json()}},{key:"openDB",value:function(){return idb.open("restaurantsDB",1,function(t){t.createObjectStore("restaurants",{keyPath:"id"}).createIndex("by-id","id")})}},{key:"getRestaurantsFromDB",value:function(){return n.openDB().then(function(t){if(console.log("Getting Restaurants From DB"),t)return t.transaction("restaurants").objectStore("restaurants").getAll()})}},{key:"getRestaurantsFromAPI",value:function(){return console.log("Getting Restaurants From API"),fetch(n.DATABASE_URL).then(n.checkStatus).then(n.json).then(function(t){return n.saveRestaurants(t),t})}},{key:"saveRestaurants",value:function(r){return n.openDB().then(function(t){if(t){var e=t.transaction("restaurants","readwrite"),n=e.objectStore("restaurants");return r.forEach(function(t){n.put(t)}),e.complete}}).then(function(){console.log("Restaurants Saved")})}},{key:"fetchRestaurants",value:function(e){return n.getRestaurantsFromDB().then(function(t){return t.length?Promise.resolve(t):n.getRestaurantsFromAPI()}).then(function(t){e(null,t)}).catch(function(t){e(t,null)})}},{key:"fetchRestaurantById",value:function(r,u){n.fetchRestaurants(function(t,e){if(t)u(t,null);else{var n=e.find(function(t){return t.id==r});n?u(null,n):u("Restaurant does not exist",null)}})}},{key:"fetchRestaurantByCuisine",value:function(r,u){n.fetchRestaurants(function(t,e){if(t)u(t,null);else{var n=e.filter(function(t){return t.cuisine_type==r});u(null,n)}})}},{key:"fetchRestaurantByNeighborhood",value:function(r,u){n.fetchRestaurants(function(t,e){if(t)u(t,null);else{var n=e.filter(function(t){return t.neighborhood==r});u(null,n)}})}},{key:"fetchRestaurantByCuisineAndNeighborhood",value:function(r,u,a){n.fetchRestaurants(function(t,e){if(t)a(t,null);else{var n=e;"all"!=r&&(n=n.filter(function(t){return t.cuisine_type==r})),"all"!=u&&(n=n.filter(function(t){return t.neighborhood==u})),a(null,n)}})}},{key:"fetchNeighborhoods",value:function(u){n.fetchRestaurants(function(t,n){if(t)u(t,null);else{var r=n.map(function(t,e){return n[e].neighborhood}),e=r.filter(function(t,e){return r.indexOf(t)==e});u(null,e)}})}},{key:"fetchCuisines",value:function(u){n.fetchRestaurants(function(t,n){if(t)u(t,null);else{var r=n.map(function(t,e){return n[e].cuisine_type}),e=r.filter(function(t,e){return r.indexOf(t)==e});u(null,e)}})}},{key:"urlForRestaurant",value:function(t){return"./restaurant.html?id="+t.id}},{key:"imageUrlForRestaurant",value:function(t,e){if(t.photograph)return"/buildTool/img/"+t.id+".jpg"}},{key:"mapMarkerForRestaurant",value:function(t,e){return new google.maps.Marker({position:t.latlng,title:t.name,url:n.urlForRestaurant(t),map:e,animation:google.maps.Animation.DROP})}},{key:"DATABASE_URL",get:function(){return"http://localhost:1337/restaurants"}}]),n}();
//# sourceMappingURL=dbhelper.js.map
