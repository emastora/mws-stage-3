"use strict";var map,restaurant=void 0;window.initMap=function(){fetchRestaurantFromURL2(function(e,t){e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),console.log(t.latlng),console.log(t.id))})};var fetchRestaurantFromURL=function(){return new Promise(function(n,r){if(self.restaurant)return n(self.restaurant);var e=getParameterByName("id");if(!e){return r("No restaurant id in URL")}DBHelper.fetchRestaurantById(e,function(e,t){if(!(self.restaurant=t))return r(e);fillRestaurantHTML(),DBHelper.fetchReviewByRestaurant(t.id).then(function(e){return fillReviewsHTML(e),fillFavouritesHTML(t.is_favorite),n(self.restaurant)}).catch(function(e){return r(e)})})})},fetchRestaurantFromURL2=function(){return new Promise(function(e,n){if(self.restaurant)return e(self.restaurant);var t=getParameterByName("id");if(console.log(t),!t){return n("No restaurant id in URL")}DBHelper.fetchRestaurantById(t,function(e,t){if(!(self.restaurant=t))return n(e)})})},fillRestaurantHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant;document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;var t=document.getElementById("restaurant-img");t.className="restaurant-img",t.src=DBHelper.imageUrlForRestaurant(e),t.setAttribute("alt","Photo of the "+e.name+" restaurant"),document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML()},fillRestaurantHoursHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.operating_hours,t=document.getElementById("restaurant-hours");for(var n in e){var r=document.createElement("tr"),a=document.createElement("td");a.innerHTML=n,r.appendChild(a);var i=document.createElement("td");i.innerHTML=e[n],r.appendChild(i),t.appendChild(r)}},fillReviewsHTML=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant.reviews,t=document.getElementById("reviews-container"),n=document.createElement("h2");if(n.innerHTML="Reviews",t.appendChild(n),!e){var r=document.createElement("p");return r.innerHTML="No reviews yet!",void t.appendChild(r)}var a=document.getElementById("reviews-list");e.forEach(function(e){a.appendChild(createReviewHTML(e))}),t.appendChild(a)},resetReviewsHTML=function(){var e=document.getElementById("reviews-container");e.innerHTML="";var t=document.createElement("ul");t.id="reviews-list",e.appendChild(t)},createReviewHTML=function(e){var t=document.createElement("li"),n=document.createElement("p");n.innerHTML=e.name,t.appendChild(n);var r=document.createElement("p");r.innerHTML=new Date(e.updatedAt).toLocaleDateString(),t.appendChild(r);var a=document.createElement("p");a.innerHTML="Rating: "+e.rating,t.appendChild(a);var i=document.createElement("p");return i.innerHTML=e.comments,t.appendChild(i),t},fillBreadcrumb=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:self.restaurant,t=document.getElementById("breadcrumb"),n=document.createElement("li");n.innerHTML=e.name,t.appendChild(n)},getParameterByName=function(e,t){t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var n=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return n?n[2]?decodeURIComponent(n[2].replace(/\+/g," ")):"":null},submitReview=function(){var e={},t=document.getElementById("post-review-form"),n=document.getElementById("restaurant_id");n.value=parseInt(getParameterByName("id")),t.appendChild(n);for(var r=0;r<t.length;++r){var a=t[r].name,i=t[r].value;""!==a&&""!==i&&("restaurant_id"!==a&&"rating"!==a||(i=parseInt(i)),e[t[r].name]=i)}t.reset(),DBHelper.sendReview(e)},favoriteToggle=function(){var e=document.getElementById("is_fav");e.classList.toggle("is_favorite");var t="false",n="Like!";"true"===e.getAttribute("aria-pressed")?(t="false",n="Like!"):(t="true",n="Remove Like!"),e.setAttribute("aria-pressed",t),e.setAttribute("aria-label",n),e.innerHTML=n;var r=getParameterByName("id");DBHelper.sendFavourite(r,t)},fillFavouritesHTML=function(e){var t=document.getElementById("is_fav"),n="",r="";"true"===e||!0===e?(n="true",r="Remove Like!",t.classList.add("is_favorite")):(n="false",r="Like!",t.classList.remove("is_favorite")),t.setAttribute("aria-pressed",n),t.setAttribute("aria-label",r),t.innerHTML=r};fetchRestaurantFromURL().then(function(t){fillBreadcrumb(),document.getElementById("post-review-form").addEventListener("submit",function(e){e.preventDefault(),submitReview()}),document.addEventListener("update_reviews_list",function(e){resetReviewsHTML(),DBHelper.fetchReviewByRestaurant(t.id).then(function(e){return fillReviewsHTML(e),resolve(self.restaurant)})})}).catch(function(e){console.error("Error during process ",e)});
//# sourceMappingURL=restaurant_info.js.map
